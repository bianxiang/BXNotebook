[toc]

## 6 Bionic API Primer

Starting with this chapter, you will be exploring the native APIs provided by the Android NDK.

Bionic is the POSIX standard C library that is provided by the Android platform for native application development using C and C++ programming languages. Bionic is a derivation of BSD standard C library by Google for the Android operating system. The name “Bionic” comes from the fact that it consists of a mixture of BSD C library pieces with custom Linux-specific bits for handling threads, processes, and signals.

Bionic is a highly vital subject for native application development, since it provides the minimal set of constructs that are needed to develop any type of functional native code on Android platform. In the following chapters, you will be relying heavily on the functionality provided by the Bionic. 在进入 Bionic 细节前，让我们先快速过一遍标准库。

### 6.1 过一遍标准库

对于 C，ANSI C 标准定义了标准库的范围。该标准库称为 C 标准库，或简称 **libc**。

On top of the standard C library specification, the POSIX C library specification declares the additional constructs that should be included in such standard library on POSIX compliant systems.

### 6.2 Yet Another C Library?

Google 重新发明一个 C 库，而不用 GNU C Library (glibc) 或 C Library for Embedded Linux (uClibc)，可以总结为三个原因：

- License: Both the glibc and uClibc are available under GNU Lesser General Public License (LGPL), thus restricting the way they can be used by proprietary applications. Instead, Bionic is published under the BSD license, a highly permissive license that does not set any restriction on the use of the library.
- Speed: Bionic is specifically crafted for mobile computing. It is tailored to work efficiently despite the limited CPU cycles and memory available on the mobile devices.
- Size: Bionic is designed with the core philosophy of keeping it simple. It provides lightweight wrappers around kernel facilities and a lesser set of APIs, making it smaller compared to other alternatives. This chapter will cover these APIs.

**二进制兼容**

尽管是 C 标准库，Bionic 与其他 C 库并不二进制兼容。Object files and static libraries that are produced against other C libraries should not be dynamically linked with Bionic. 否则会导致链接或最终的执行出问题。

Besides that, any application that is generated by statically linking with other C libraries and not mixed with Bionic can run on the Android platform without any issues, unless it is dynamically loading any other system library during runtime.

**它提供什么？**

Bionic provides C standard library macros, type definitions, functions, and small number of Android-specific features that can be itemized under these functionality domains:

 Memory Management
 File Input and Output
 String Manipulation
 Mathematics
 Date and Time
 Process Control
 Signal Handling
 Socket Networking
 Multithreading
 Users and Groups
 System Configuration
 Name Service Switch

**它缺少什么**

As mentioned, Bionic is specifically designed for Android platform and tuned for mobile computing. Not every function in the standard C library is supported by Bionic. Android NDK documentation does provide a full list of missing functionality; however, such information is available within the actual header files itself. Bionic header files can be located `platforms/android-<api-level>/arch-<architecture>/usr/include` under the `ANDROID_NDK_HOME` directory. Each header file in this directory contains a section clearly marking the list of missing functions. As an example, the section listing the missing functions in `stdio.h` header file is shown in Listing 6-1.

```
    #if 0 /* MISSING FROM BIONIC */
    char *ctermid(char *);
    char *cuserid(char *);
    #endif /* MISSING */
```

The pre-processor `if` statement is used to disable these lines in the header file, and the associated comment indicates that the section contains the list of missing functions. In addition to this list, the Android NDK documentation also cites the functions that are exposed through Bionic but implemented as a stub only, without any or minimal functionality.

### 6.3 内存管理